You want **Laravel Spatie Permission** style:

* Roles
* Permissions
* Assign roles to user
* Protect routes based on roles
* Protect actions (CRUD) based on permissions

â¡ï¸ **Same system fully in Next.js** (API + Middleware + DB design)
Here is the **best and cleanest architecture**.

---

# âœ… 1. Database Structure (exactly like Spatie)

### **users**

```
id | name | email | password | role_id
```

### **roles**

```
id | name ("admin", "editor", "user")
```

### **permissions**

```
id | name ("post.create", "post.update", "post.delete")
```

### **role_permissions**

```
role_id | permission_id
```

---

# âœ… 2. Assign role to user (API route)

### `/api/admin/assign-role`

```javascript
// pages/api/admin/assign-role.js
import db from "../../../lib/db";

export default async function handler(req, res) {
  const { userId, roleId } = req.body;

  await db.user.update({
    where: { id: userId },
    data: { roleId },
  });

  res.json({ success: true, message: "Role assigned" });
}
```

---

# âœ… 3. Check role & permissions in Next.js Middleware (like Laravel Middleware)

Create `middleware.js`:

```javascript
import { NextResponse } from "next/server";
import { getToken } from "next-auth/jwt";

export async function middleware(req) {
  const token = await getToken({ req });

  if (!token) {
    return NextResponse.redirect(new URL("/login", req.url));
  }

  const role = token.role;

  const pathname = req.nextUrl.pathname;

  // Route protection example
  if (pathname.startsWith("/admin") && role !== "admin") {
    return NextResponse.redirect(new URL("/unauthorized", req.url));
  }

  if (pathname.startsWith("/editor") && !["admin", "editor"].includes(role)) {
    return NextResponse.redirect(new URL("/unauthorized", req.url));
  }

  return NextResponse.next();
}

export const config = {
  matcher: ["/admin/:path*", "/editor/:path*", "/dashboard/:path*"],
};
```

This is **exactly like Laravel: `->middleware('role:admin')`**.

---

# âœ… 4. Protect API Routes (like Laravelâ€™s Gate/Policy)

Example API: `/api/post/create`

```javascript
import { getToken } from "next-auth/jwt";

export default async function handler(req, res) {
  const token = await getToken({ req });

  if (!token) return res.status(401).json({ message: "Unauthenticated" });

  if (!token.permissions.includes("post.create")) {
    return res.status(403).json({ message: "Permission denied" });
  }

  // Create post...
  res.json({ success: true });
}
```

---

# âœ… 5. When user logs in, load roles + permissions into JWT

Example with NextAuth:

```javascript
callbacks: {
  async jwt({ token, user }) {
    if (user) {
      token.role = user.role.name;
      token.permissions = user.role.permissions.map(p => p.name);
    }
    return token;
  },

  async session({ session, token }) {
    session.user.role = token.role;
    session.user.permissions = token.permissions;
    return session;
  }
}
```

Now your frontend knows:

```json
{
  "role": "admin",
  "permissions": ["post.create", "post.edit"]
}
```

---

# âœ… 6. Frontend Component Protection (like Laravel `@can` directive)

```javascript
export default function CreatePostButton({ session }) {
  if (!session.user.permissions.includes("post.create")) {
    return null; // hide button
  }

  return <button>Create Post</button>;
}
```

---

# âœ” Final Architecture Summary (Laravel â†’ Next.js)

| Laravel (Spatie)           | Next.js Equivalent                    |
| -------------------------- | ------------------------------------- |
| `roles` table              | roles table                           |
| `permissions` table        | permissions table                     |
| `role_has_permissions`     | role_permissions                      |
| `assignRole()`             | API endpoint `/api/admin/assign-role` |
| `middleware('role:admin')` | Next.js `middleware.js`               |
| `@can('post.create')`      | `if(session.permissions.includes())`  |
| Policies                   | API-level permission checks           |
| Guard                      | NextAuth JWT                          |

---

# ğŸš€ If you want, I can generate:

ğŸ”¥ **Full ready-to-use Next.js Spatie Package clone**
with:

* Role model
* Permission model
* Middleware
* Guards
* Policies
* UI example
* DB migrations (Prisma, Mongoose, or MySQL SQL)
* Role management dashboard

Just tell me: **Next.js with which DB? Prisma/MySQL? Mongoose/MongoDB?**



============================================================ with mysql ===========================================================


Here is **the clean and correct way to implement Roles + Permissions + Route Protection in Next.js 16 (App Router)** â€” similar to **Laravel Breeze + Spatie Permission**.

---

# âœ… **Next.js 16 Role & Permission System (Like Laravel Spatie)**

We will build:

### âœ” Roles

### âœ” Permissions

### âœ” Middleware-based route protection

### âœ” Protect API routes

### âœ” Protect Server Components

### âœ” Protect Client components

---

# ğŸ§± **1. Database Structure (MySQL)**

Use **Prisma** (recommended for Next.js):

`prisma/schema.prisma`:

```prisma
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  roleId    Int?
  role      Role?    @relation(fields: [roleId], references: [id])
}

model Role {
  id          Int        @id @default(autoincrement())
  name        String      @unique
  permissions Permission[]
  users       User[]
}

model Permission {
  id      Int    @id @default(autoincrement())
  name    String @unique
  roleId  Int?
  role    Role?  @relation(fields: [roleId], references: [id])
}
```

---

# ğŸ›  **2. Seed Roles & Permissions (Like Spatie)**

`prisma/seed.ts`

```ts
import { PrismaClient } from "@prisma/client";
const prisma = new PrismaClient();

async function main() {
  const admin = await prisma.role.upsert({
    where: { name: "admin" },
    update: {},
    create: { name: "admin" },
  });

  const user = await prisma.role.upsert({
    where: { name: "user" },
    update: {},
    create: { name: "user" },
  });

  await prisma.permission.createMany({
    data: [
      { name: "create_post", roleId: admin.id },
      { name: "delete_post", roleId: admin.id },
      { name: "view_post", roleId: user.id },
    ],
  });
}

main();
```

---

# ğŸ§© **3. Store User Role in JWT Session (Next.js Auth)**

Use **NextAuth** for login.

```ts
// auth.ts
callbacks: {
  async jwt({ token, user }) {
    if (user) {
      token.role = user.role?.name;
    }
    return token;
  },
  async session({ session, token }) {
    session.user.role = token.role;
    return session;
  },
}
```

---

# ğŸ›¡ **4. Middleware: Block Unauthorized Routes**

`middleware.ts`

```ts
import { withAuth } from "next-auth/middleware";

export default withAuth({
  callbacks: {
    authorized: ({ token, req }) => {
      const pathname = req.nextUrl.pathname;

      if (pathname.startsWith("/admin")) {
        return token?.role === "admin"; // Only admin allowed
      }

      if (pathname.startsWith("/dashboard")) {
        return !!token; // Logged in user only
      }

      return true;
    },
  },
});

export const config = {
  matcher: ["/admin/:path*", "/dashboard/:path*"],
};
```

âœ” Works just like Laravel middleware
âœ” Protects pages and API routes
âœ” Fully secure (runs on edge)

---

# ğŸ”’ **5. Permission Checks (Helper Function Like Spatie)**

`lib/permissions.ts`

```ts
export function can(user, permission: string) {
  return user?.permissions?.includes(permission);
}
```

---

# ğŸ–¥ **6. Protect Server Components**

In Next.js App Router:

```tsx
import { auth } from "@/auth";

export default async function AdminPage() {
  const session = await auth();

  if (session?.user.role !== "admin") {
    return <h1>Unauthorized</h1>;
  }

  return <h1>Admin Dashboard</h1>;
}
```

---

# ğŸ§ª **7. Protect API Routes (Like Laravel Route::middleware())**

`app/api/admin/create/route.ts`

```ts
import { auth } from "@/auth";

export async function POST() {
  const session = await auth();

  if (session?.user.role !== "admin") {
    return Response.json({ error: "Forbidden" }, { status: 403 });
  }

  return Response.json({ message: "OK" });
}
```

---

# ğŸ¯ **8. Protect Client Components**

```tsx
"use client";
import { useSession } from "next-auth/react";

export default function OnlyAdmin({ children }) {
  const { data } = useSession();
  if (data?.user.role !== "admin") return null;
  return children;
}
```

Use:

```tsx
<OnlyAdmin>
  <button>Delete User</button>
</OnlyAdmin>
```

---

# ğŸ† This setup gives you full Laravel-style RBAC:

### âœ” Roles

### âœ” Permissions

### âœ” Middleware

### âœ” Guarded Routes

### âœ” API Protection

### âœ” Server + Client protection

### âœ” Works with MySQL + Prisma

This is **the closest 1:1 alternative to Laravel + Spatie in Next.js 16**.

---

# Want?

If you want, I can give you:

### âœ… Full ready-made boilerplate (GitHub-ready)

### âœ… Admin panel UI for role/permission management

### âœ… Auth + role-based sidebar like Laravel Breeze

### âœ… Full API + CRUD + protected dashboard

Just tell me **â€œgive full RBAC boilerplateâ€**.
